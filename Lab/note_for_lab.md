[TOC]

## Lab

> ### Labæ˜¯CSAPPçš„ç²¾å
>
> è¦å°½é‡è‡ªå·±ç‹¬ç«‹çš„å®Œæˆï¼Œå¯ä»¥å€ŸåŠ©ç½‘ç»œèµ„æºæ¥å®Œå–„å’Œæé†’ï¼Œåˆ‡å¿Œä¸èƒ½çœ‹åˆ«äººçš„å®ç°ç„¶åç®€å•çš„copyä¸€ä»½ï¼

### Data Lab

![image-20241221221513536](assets/Datalab.png)

#### **bitxor**

é¢˜ç›®åˆ†æï¼Œä»…ç”¨`~(æŒ‰ä½å–å)` and `&(æŒ‰ä½ä¸)`ï¼Œæœ¬è´¨ä¸Šä¸€é“é€»è¾‘è¿ç®—çš„ä¹ é¢˜ã€‚

$A\oplus B=?$

1. æ˜¾è€Œæ˜“è§çš„ä¸€ç§

$A \oplus B = \sim (A \& B) \& (\sim A \& \sim B)$

#### tmin 

è¿”å›äºŒè¿›åˆ¶æœ€å°çš„å€¼(0x80000000) = $-2^{31}$ 

æœ€ç›´æ¥çš„æƒ³æ³•å°±æ˜¯ç”¨1ç„¶åå·¦ç§»åŠ¨31ä½

å…è®¸ä½¿ç”¨çš„æ•´æ•°ä¸º(0x0 ~0xff(255)),å’‹ç›´æ¥å®šä¹‰ä¸€ä¸ªæœ€å¤§æ•´æ•°æ˜¯ä¸åˆç†çš„ã€‚

#### isTmax ?

äºŒè¿›åˆ¶æœ€å¤§çš„æ•°ä¸º(0x7ffffff) = $2^{31} - 1$ 

#### alloddbits

åˆ¤æ–­æŸä¸ªæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„å¥‡æ•°ä½æ˜¯å¦å…¨ä¸º`1`

> Input: 0xFFFFFFFD
>
> Output: 0
>
> Expian:
>
> D = 1101
>
> â€‹       |-----> ä½ç½®1(å¥‡æ•°)å¯¹äºçš„äºŒè¿›åˆ¶æ•°ä¸º`0`è€Œé`1`
>
> Input: 0xAAAAAAAA
>
> Output: 1
>
> Expian:
>
> 1010 1010 .... 1010
>
>  |  |  |  |         |  | ----> æ‰€æœ‰å¥‡æ•°ä½éƒ½ä¸º`1`  



### Bomb Lab

> [!important]
>
> ä¸»è¦ç›®æ ‡æ˜¯å­¦ä¼šåˆ©ç”¨gdbè°ƒè¯•æ±‡ç¼–ä»£ç ï¼Œå¹¶èƒ½é˜…è¯»æ±‡ç¼–ä»£ç ã€‚

ä¸€å…±æœ‰6ä¸ªphaseå’Œä¸€ä¸ªéšè—å…³å¡

| gdbå‘½ä»¤      | å¤‡æ³¨                                       |
| ------------ | ------------------------------------------ |
| `layout xxx` | - asm æ±‡ç¼–ä»£ç <br />- src æºä»£ç            |
| `run/r`      | è¿è¡Œ                                       |
| `break/b`    | è®¾ç½®æ–­ç‚¹<br />- ç›´æ¥æ¥å‡½æ•°å<br />- *+åœ°å€ |
| `ni`         | ä¸‹ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤                             |
| `si`         | æ­¥å…¥ä¸‹ä¸€æ¡æ±‡ç¼–æŒ‡ä»¤                         |

#### ==Phase_1==

æ— è®ºå¦‚ä½•å…ˆåœ¨mainå‡½æ•°è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ï¼Œçœ‹çœ‹ç¨‹åºæ˜¯å¦‚ä½•è¿è¡Œçš„ä¸ºå¥½ã€‚

![image-20241231221808680](assets/image-20241231221808680.png)

æŸ¥çœ‹ä¸€ä¸‹phase_1çš„åæ±‡ç¼–ç»“æœ

![image-20241231221913440](assets/image-20241231221913440.png)

å¾ˆå®¹æ˜“å‘ç°è°ƒç”¨äº†ä¸€ä¸ª`string_not_equal`å‡½æ•°ï¼Œå¹¶ä¸”å¦‚æœæµ‹è¯•æˆåŠŸåˆ™ä¸ä¼šè¿›å…¥`explode_bomb`å¦åˆ™å°±ä¼šå¼•çˆ†ğŸ’£ï¼Œæ‰€ä»¥å…³é”®å°±æ˜¯è¿™ä¸ªè°ƒç”¨

è€Œè¿™ä¸ª`mov $0x402400, $esi` æ˜¾ç„¶æ˜¯æŠŠæˆ‘ä»¬çš„è¾“å…¥çš„å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ å…¥è¿™ä¸ª`strings_not_equal`,æˆ‘ä»¬åªéœ€è¦è¿›å…¥è¿™ä¸ªå‡½æ•°çœ‹ä¸€ä¸‹ï¼Œå®ƒæƒ³è¦å¾—åˆ°é‚£ä¸ªå­—ç¬¦ä¸²å°±å¯ä»¥ã€‚

ç«‹åˆ»å»çœ‹çœ‹å§ï¼

![image-20241231222545211](assets/image-20241231222545211.png)

`%rbx ä¿å­˜è¾“å…¥ï¼Œ %rbp è‚¯å®šçš„å¸¦æ¯”è¾ƒç»“æœ` å¯ä»¥ç”¨x/sæ‰“å°çœ‹ä¸€ä¸‹

![image-20241231222645640](assets/image-20241231222645640.png)

ç¬¬ä¸€é¢˜è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„

![image-20241231222812374](assets/image-20241231222812374.png)



#### ==Phase_2==

> [!warning]
>
> å¯ä»¥æŠŠä¸Šä¸€é¢˜çš„ç­”æ¡ˆå†™å…¥ä¸€ä¸ªæ–‡ä»¶ç„¶åç”¨`set args xxx.txt`è®¾ç½®ä¸ºå‚æ•°ï¼Œå°±ä¸éœ€è¦æ¯æ¬¡éƒ½é‡å¤è¾“å…¥ç»“æœäº†

![image-20241231224240688](assets/image-20241231224240688.png)

é€šè¿‡ä¸Šä¸€é¢˜å¤§æ¦‚å¯ä»¥çŸ¥é“ï¼Œä¸»è¦çš„æµ‹è¯•å°±æ˜¯`phase_x`é‡Œé¢ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ‰“ç«¯ç‚¹çœ‹çœ‹

![image-20241231223134451](assets/image-20241231223134451.png)

å‡½æ•°åéƒ½æç¤ºäº†è¦è¾“å…¥6ä¸ªæ•´æ•°ï¼Œæ‰€ä»¥å¦‚æœè¾“å…¥çš„ä¸æ˜¯6ä¸ªæ•´æ•°çš„è¯é‡æ–°è§£å¯†å§ï¼

![image-20241231223423082](assets/image-20241231223423082.png) æ‰§è¡Œå®Œ`read_six_numbers`åå°±è¦æ¯”è¾ƒ,`($rsp)`å¯¹åº”çš„ä¸ºæˆ‘ä»¬è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—ï¼Œè¿™é‡Œè¦æ±‚ä¸º`0x1`å“¦ï¼Œå¦‚æœä¸æ˜¯ä¸‹ä¸€æ­¥å°±ç›´æ¥call `explode_bomb`

> [!important]
>
> ç¬¬ä¸€ä¸ªæ•°å­—ä¸º `1`

![image-20241231223731300](assets/image-20241231223731300.png)

æ‰§è¡Œè·³è½¬åˆ°è¿™ä¸€æ­¥ï¼Œæ˜¾ç„¶æ˜¯æŠŠç¬¬äºŒä¸ªå˜é‡å¯¹åº”çš„å†…å­˜åœ°å€ï¼Œå†™å…¥$rbxä¸­

æ‰§è¡Œæ‰§è¡Œï¼Œåˆ°è¿™ä¸ª

![image-20241231223914074](assets/image-20241231223914074.png)

æŠŠä¸Šä¸€ä¸ªè¾“å…¥`1`å­˜å…¥äº†`$eax`

![image-20241231223944967](assets/image-20241231223944967.png)

è¿™é‡Œç›¸å½“äº`args1+args1 ? args2`

![image-20241231224023105](assets/image-20241231224023105.png)

é€šè¿‡æµ‹è¯•æ¡ä»¶æˆ‘ä»¬å¯çŸ¥ï¼Œå¦‚æœä¸ç­‰å’‹ä¼šå¼•çˆ†ï¼Œæ‰€ä»¥å¯ä»¥å¾—åˆ°ç­”æ¡ˆåº”è¯¥æ˜¯`1 2 4 8 16 32`



#### ==Phase_3==

è¿™ä¸ªæ±‡ç¼–ä»£ç å°±æ¯”è¾ƒé•¿äº†

![image-20241231224618046](assets/image-20241231224618046.png)

`0x400f5b` ---> sscanf è°ƒç”¨å¹¶è¿”å›æ¥å—å‚æ•°çš„ä¸ªæ•°ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªåˆ¤æ–­éœ€è¦è®©`$eax > 1` å³è‡³å°‘æœ‰è¦æœ‰ä¸¤ä¸ªè¾“å…¥

![image-20241231225218193](assets/image-20241231225218193.png)

å¯ä»¥ç”¨`x $rsp+0x8`æŸ¥çœ‹ï¼Œä¼šå‘ç°æ˜¯ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¦‚æœç¬¬ä¸€ä¸ªè¾“å…¥å¤§äº`0x7`åˆ™è·³è½¬ï¼Œä½†è¿™ä¸ªåœ°å€å§å°±æ˜¯` explode_bomb`ï¼Œå¦åˆ™æŠŠ`args1`å­˜å…¥`%eax`,å¹¶ä¸”`args1=1`çš„æƒ…å†µ,

![image-20241231225348595](assets/image-20241231225348595.png)

è¿™æ¡æŒ‡ä»¤æ˜¯è·³è½¬åˆ° 0x402470 + 8%rax å¯¹åº”çš„å†…å­˜åœ°å€

![image-20241231225532549](assets/image-20241231225532549.png)

æŠŠ`0x137`å­˜å…¥`%eax`

![image-20241231225625786](assets/image-20241231225625786.png)

è¿™é‡Œä¼šæ¯”è¾ƒ`args2`å’Œ`0x137(311)`

å³ç¬¬äºŒä¸ªå‚æ•°ä¸º311æ—¶å€™å°±æ‹†é™¤æˆåŠŸäº†

![image-20241231225848103](assets/image-20241231225848103.png)

åŒç†å½“`args1<=7`å¹¶ä¸”ç­‰äºå…¶ä»–å€¼çš„æ—¶å€™ä¹Ÿæœ‰ç­”æ¡ˆ

| arg 1 | arg 2 |
| ----- | ----- |
| 1     | 0x137 |
| 2     | 0x2c3 |
| 3     | 0x100 |
| 4     | 0x185 |
| 5     | 0xce  |
| 6     | 0x2aa |
| 7     | 0x147 |



### Attack Lab

### Arch Lab

### Cache Lab

### Tsh Lab

#### Malloc Lab

#### Proxy Lab

